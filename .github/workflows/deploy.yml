name: Deploy to Ali OSS

on:
    push:
      branches:
          - develop

jobs:
    build:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4

            - name: Get version
              run: |
                  version=$(node -p "require('./package.json').version")
                  echo "CURRENT_VERSION=$version" >> $GITHUB_ENV

            - name: Build
              run: |
                  npm ci
                  npm run build

            - name: Install static-deploy-tool
              run: npm i -g static-deploy-tool

            - name: Sync
              run: static-deploy-tool sync "build" "static-deploy-tool-test/action-sync"
              env:
                  OSS_AK: ${{ secrets.OSS_AK }}
                  OSS_SK: ${{ secrets.OSS_SK }}
                  OSS_REGION: ${{ secrets.OSS_REGION }}
                  OSS_BUCKET: ${{ secrets.OSS_BUCKET }}
                  OSS_ENDPOINT: oss-accelerate.aliyuncs.com
